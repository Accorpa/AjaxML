function hashHistory(a){var b=$(a.target);var c=b.attr("history");historyMap.setItem(c,a);latestHash=c;window.location.hash=c}function repeatCall(a){if(historyMap.hasItem(a))try{ajaxClick(historyMap.getItem(a))}catch(b){}}function repeatSubmit(){if(latestSubmit){ajaxSubmit(latestSubmit)}}function repeatLatest(){if(latestEvent){ajaxClick(latestEvent)}}function HistoryMap(){this.length=0;this.items=new Array;for(var a=0;a<arguments.length;a+=2){if(typeof arguments[a+1]!="undefined"){this.items[arguments[a]]=arguments[a+1];this.length++}}this.removeItem=function(a){var b=undefined;if(typeof this.items[a]!="undefined"){this.length--;b=this.items[a];delete this.items[a]}return b};this.getItem=function(a){return this.items[a]};this.setItem=function(a,b){var c=undefined;if(typeof b!="undefined"){if(typeof this.items[a]=="undefined"){this.length++}else{c=this.items[a]}this.items[a]=b}return c};this.hasItem=function(a){return typeof this.items[a]!="undefined"};this.clear=function(){for(var a in this.items){delete this.items[a]}this.length=0}}function redirectForm(a){var b=a.attr("bind");$("body").append('<iframe id="frame'+b+'" name="frame'+b+'" bind="'+b+'" src="about:blank" style="display:none"></iframe>');var c=a.parents("form:first");c.attr("bind",b);a.unbind("change");a.change(function(){});if(c){c.attr("target","frame"+b);c.attr("method","POST");c.attr("enctype","multipart/form-data");c.attr("encoding","multipart/form-data");bindSubmit(c,b)}}function addHiddenForm(a){var b=a.attr("bind");$("body").append('<iframe id="frame'+b+'" name="frame'+b+'" bind="'+b+'" src="about:blank" style="display:none"></iframe>');a.before('<span id="upload_div'+b+'" class="upload_div" bind="'+b+'"></span>');$("body").append('<form id="form'+b+'" target="frame'+b+'"></form>');var c=$('form[id="form'+b+'"]');c.css("display","none");a.unbind("change");a.change(function(){a.css("visibility","hidden");c.append(a);c.submit()});if(c){c.attr("action",a.attr("action"));c.attr("target","frame"+b);c.attr("method","POST");c.attr("enctype","multipart/form-data");c.attr("encoding","multipart/form-data");c.attr("into",a.attr("into")||"upload_div"+b);c.attr("bind",a.attr("bind"));bindHiddenSubmit(c,b)}}function bindHiddenSubmit(a,b){a.unbind("submit");a.submit(function(){var c=a.attr("into");$("#"+c).attr("bind",b);if(a.attr("into")=="self"){if(!a.attr("insert")||a.attr("insert")=="")a.attr("insert","before");ajaxWait(a.attr("id"))}else{ajaxWait(a.attr("into"))}var d=$('iframe[bind="'+b+'"]');var e=undefined;var f=$('input[type="file"][bind="'+b+'"]');if(f){e=f.attr("resultId")}evalOnStart(a,a.attr("into"));d.unbind("load");d.load(function(){var d=$('iframe[name="frame'+b+'"]');res=d.contents().find("html body").html();if(res){if(a.attr("into")){if(a.attr("onLoad"))res=evalOnLoad(a,a.attr("into"),res);ajaxPlace(c,res)}else{ajaxPlace(c,res);$('.upload_div[bind="'+b+'"]').html(res)}evalOnComplete(a,a.attr("into"));f.css("visibility","visible");$('.upload_div[bind="'+b+'"]').after(f);ajaxCleanUp(a.attr("id"),a.attr("bind"));ajaxify()}if(e){res=d.contents().find("#"+e).html();$('input[type="hidden"][bind="'+b+'"]').attr("value",res)}else $('input[type="hidden"][bind="'+b+'"]').attr("value",f.attr("value"));f.css("display","inline")})})}function bindSubmit(a,b){a.unbind("submit");a.submit(function(){var c;if(a.attr("into")=="self"){c=a.attr("id")}else{c=a.attr("into")}$("#"+c).attr("bind",b);if(a.attr("into")=="self"){if(!a.attr("insert")||a.attr("insert")=="")a.attr("insert","before");ajaxWait(a.attr("id"))}else{ajaxWait(a.attr("into"))}var d=$('iframe[bind="'+b+'"]');var e=$('input[type="file"][bind="'+b+'"]');evalOnStart(a,a.attr("into"));d.unbind("load");d.load(function(){var d=$('iframe[name="frame'+b+'"]');res=d.contents().find("html body").html();if(res){if(a.attr("into")){res=evalOnLoad(a,a.attr("into"),res);ajaxPlace(c,res)}else{ajaxPlace(c,res);$('.upload_div[bind="'+b+'"]').html(res)}evalOnComplete(a,a.attr("into"));e.css("visibility","visible");$('.upload_div[bind="'+b+'"]').after(e);ajaxCleanUp(a.attr("id"),a.attr("bind"));ajaxify()}e.css("display","inline")})})}function loadInto(a,b,c,d){if(c=="delete"){if(!confirm("Are You Sure?"))return false}var e=$("#"+a);e.attr("bind",d.attr("bind"));$('span[bind="'+e.attr("bind")+'"]').remove();evalOnStart(d,a);ajaxWait(a);$.ajax({type:c,dataType:"html",url:b,beforeSend:ajaxHeaders,success:function(b){b=evalOnLoad(d,a,b);ajaxPlace(a,b);ajaxCleanUp($("#"+a).attr("id"),$("#"+a).attr("bind"));ajaxify();evalOnComplete(d,a);return false},error:function(b,c,e){ajaxError(a);evalOnError(d,a);return false}});return false}function ajaxHeaders(a){a.setRequestHeader("Accept","text/ajax")}function ajaxify(){$("a[into]").removeAttr("onclick");$("a[into]:not([bind])").each(function(){var a=$(this);setBinder(this);a.bind("click",ajaxClick)});$("select[into]:not([bind])").each(function(){var a=$(this);setBinder(this);a.bind("change",ajaxClick)});$("button[into]:not([bind])").each(function(){var a=$(this);setBinder(this);a.bind("click",ajaxClick)});$("input:button[into]:not([bind])").each(function(){var a=$(this);setBinder(this);a.bind("click",ajaxClick)});$("input:checkbox[into]:not([bind])").each(function(){var a=$(this);setBinder(this);a.bind("click",ajaxClick)});$("input:radio[into]:not([bind])").each(function(){var a=$(this);setBinder(this);a.bind("click",ajaxClick)});$("input:text[into]:not([bind])").each(function(){var a=$(this);setBinder(this);a.bind("keyup",ajaxClick)});if(HistoryMap){$("a[history]").bind("click",hashHistory);$("select[history]").bind("change",hashHistory);$("button[history]").bind("click",hashHistory)}$("form[into]:not([bind])").each(function(){var form=$(this);var hasFileInput=form.has("input[type='file']");var hasHandledFileInput=form.has("input[type='file'][action]");if(!hasFileInput||hasHandledFileInput){setBinder(this);form.submit(function(){latestSubmit=this;var form=$(this);if(form.attr("validate")){eval("var validation = ("+form.attr("validate")+")");if(validation==false)return false}var target=form.attr("into");if(target=="self")target=form.attr("id");evalOnStart(form,form.attr("into"));if(form.attr("also")){eval("var hash = ("+form.attr("also")+")");jQuery.each(hash,function(a,b){into=$("#"+a);if(b==""){into.html("")}else if(b=="hide"){into.hide(400)}else{loadInto(a,b,"get",form)}})}var method=form.attr("method")||"POST";var url=form.attr("action");if(form.attr("into")=="self"){if(!form.attr("insert")||form.attr("insert")=="")form.attr("insert","before");ajaxWait(form.attr("id"))}else{$("#"+form.attr("into")).attr("bind",form.attr("bind"));ajaxWait(form.attr("into"))}$.ajax({type:method,dataType:"html",data:form.serialize(),url:url,beforeSend:ajaxHeaders,success:function(a){a=evalOnLoad(form,form.attr("into"),a);ajaxCleanUp(form.attr("id"),form.attr("bind"));if(form.attr("into")=="self"){ajaxPlace(form.attr("id"),a)}else{ajaxPlace(form.attr("into"),a)}ajaxify();evalOnComplete(form,form.attr("into"));return false},error:function(a,b,c){if(!form.attr("insert")||form.attr("insert")=="")form.attr("insert","prepend");if(!form.attr("id")||form.attr("id")=="")form.attr("id",form.attr("bind"));ajaxError(form.attr("id"));evalOnError(form,form.attr("into"));ajaxCleanUp(form.attr("id"),form.attr("bind"));return false}});return false})}});$('input[type="file"][action!]:not([bind])').each(function(){var a=$(this);setBinder(this);if(a.attr("action"))addHiddenForm(a);else redirectForm(a)});$(document).trigger("ajaxLoad")}function ajaxError(a){var b=$("#"+a);var c=b.attr("bind");var d=b.attr("errorMessage")||ajaxErrorMessage;d='<span class="ajaxError" bind="'+c+'">'+d+"</span>";ajaxCleanUp(b.attr("id"),b.attr("bind"));if(!b.attr("insert")||b.attr("insert")=="into"){b.show();b.html(d)}if(b.attr("insert")=="replace"){b.show();b.html(d)}if(b.attr("insert")=="before"){b.before(d)}if(b.attr("insert")=="after"){b.after(d)}if(b.attr("insert")=="prepend"){b.prepend(d)}if(b.attr("insert")=="append"){b.append(d)}}function ajaxWait(a){$(document).trigger("ajaxBefore");var b=$("#"+a);var c=b.attr("hourglass");if(!c)c=ajaxHourglass;if(c=="none")return;var d=b.attr("bind");var e='<span class="ajaxLoader" bind="'+d+'">'+c+"</span>";if(!b.attr("insert")||b.attr("insert")=="into"){b.show();b.html(e)}if(b.attr("insert")=="replace"){b.show();b.html(e)}if(b.attr("insert")=="before"){b.before(e)}if(b.attr("insert")=="after"){b.after(e)}if(b.attr("insert")=="prepend"){b.prepend(e)}if(b.attr("insert")=="append"){b.append(e)}}function ajaxCleanUp(a,b){$('span.ajaxError[errorSource="'+a+'"]').remove();$('span.ajaxLoader[bind="'+b+'"]').remove()}function ajaxPlace(element,data){if(element=="script"||element=="javascript"){eval(data);return false}var target=$("#"+element);target.show();var bind=target.attr("bind");$('span.ajaxError[bind="'+bind+'"]').remove();if(!target.attr("insert")||target.attr("insert")=="into"){target.html(data)}if(target.attr("insert")=="replace"){target.replaceWith(data)}if(target.attr("insert")=="before"){target.before(data)}if(target.attr("insert")=="after"){target.after(data)}if(target.attr("insert")=="prepend"){target.prepend(data)}if(target.attr("insert")=="append"){target.append(data)}}function ajaxClick(event){latestEvent=event;var el=$(event.target);while(!el.is("a")&&!el.is("button")&&!el.is("select")&&!el.is("input")){el=el.parent();if(el.is("body"))return}var into=$("#"+el.attr("into"));var method=el.attr("method")||"get";if(el.attr("validate")){eval("var validation = ("+el.attr("validate")+")");if(validation==false)return false}var params={};var parameters=el.attr("parameters");if(parameters)eval("params = ("+parameters+")");if(el.attr("evaluate")){eval("var evalhash = ("+el.attr("evaluate")+")");jQuery.each(evalhash,function(a,b){if(b!="")params[a]=b})}if(el.attr("from")){eval("var hash = ("+el.attr("from")+")");jQuery.each(hash,function(a,b){var c=$("#"+b);if(c){params[a]=c.val()}})}if(el.is("select")){params[el.attr("name")]=el.val()}if(el.is("input:button")){params[el.attr("name")]=el.val()}if(el.is("input:checkbox")){params[el.attr("name")]=el.is(":checked")}if(el.is("input:radio")){params[el.attr("name")]=el.val()}if(el.is("input:text")){params[el.attr("name")]=el.val()}var url=el.attr("href");jQuery.each(params,function(a,b){url=append2URL(url,a,b)});loadInto(el.attr("into"),url,method,el);if(el.attr("also")){eval("var hash = ("+el.attr("also")+")");jQuery.each(hash,function(a,b){into=$("#"+a);if(b==""){into.html("")}else if(b=="hide"){into.hide(400)}else{jQuery.each(params,function(a,c){b=append2URL(b,a,c)});loadInto(a,b,"get",el)}})}if(el.is("input:checkbox")||el.is("input:radio"))return true;else return false}function evalOnError(sender,targetid){var js=sender.attr("onError");var senderid=sender.attr("id");if(!senderid||senderid=="self")senderid=targetid;if(typeof eval(js)=="function"){eval(js+"(senderid,targetid)")}}function evalOnComplete(sender,targetid){var js=sender.attr("onComplete");var senderid=sender.attr("id");if(!senderid||senderid=="self")senderid=targetid;if(typeof eval(js)=="function"){eval(js+"(senderid,targetid)")}}function evalOnStart(sender,targetid){var js=sender.attr("onStart");var senderid=sender.attr("id");if(!senderid||senderid=="self")senderid=targetid;if(typeof eval(js)=="function"){eval(js+"(senderid,targetid)")}}function evalOnLoad(sender,targetid,data){var js=sender.attr("onLoad");var modified;if(typeof eval(js)=="function"){eval("modified="+js+"(unescape(data), sender.attr('id'),targetid)")}else{modified=data}return modified}function setBinder(a){$(a).attr("bind",Math.round(Math.random(1e6)*1e9))}function append2URL(a,b,c){var d=b+"="+c;a=decode(a);if(a!=undefined&&a!=null){return a+(a.indexOf("?")!=-1?"&"+d:"?"+d)}else{};}function decode(a){if(a!=undefined&&a!=null){return unescape(a.replace(/\+/g," "))}}var ajaxHourglass='Loading <img src="ajax-bar-loader.gif"/>';var ajaxErrorMessage="Sorry. Your request could not completed.";var historyMap=new HistoryMap;var latestHash;var latestEvent;var latestSubmit;$(document).ready(function(){ajaxify();$(window).hashchange(function(){var a=location.hash.replace(/^#/,"");var b;if(a==latestHash)return;latestHash=a;if(historyMap.hasItem(a)){ajaxClick(historyMap.getItem(a))}else{b=$("[history="+a+"]");if(b){b.click()}}});if(window.location.hash!=""){$(window).hashchange()}})